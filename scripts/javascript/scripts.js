var OS,__awaiter=this&&this.__awaiter||function(e,i,s,r){return new(s=s||Promise)(function(n,t){function l(e){try{o(r.next(e))}catch(e){t(e)}}function a(e){try{o(r.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(l,a)}o((r=r.apply(e,i||[])).next())})};function file_choice(e){var e=e.target,e=e.files?e.files[0].name.substring(0,12):"",t=document.getElementById("new-filename");null!==t&&(t.innerHTML=e),toggle_loading(!0),AJAX_send()}function AJAX_send(){return __awaiter(this,void 0,void 0,function*(){var e=document.getElementById("save-upload"),e=null==(e=null==e?void 0:e.files)?void 0:e[0];if(null===e)alert("An error occurred while uploading the file. Please try again.");else{var t=yield get_max_upload_size(),t=e.size>t;let l=document.getElementById("display");var n=document.getElementById("landing_menu");let a=null!=(i=null==(i=document.getElementById("landing_page"))?void 0:i.outerHTML)?i:"";null!==n&&(n.outerHTML=""),l.innerHTML="";var i=new FormData;let o=new XMLHttpRequest;n=get_site_root()+"/includes/get_xml_data.php";t?i.append("save-upload",new File(["SizeException"],"Error_SizeException.xml")):i.append("save-upload",e),o.open("POST",n,!0),o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var e=JSON.parse(o.responseText),t=e.html;if(l.innerHTML=t.topbar,"success"===e.code){l.innerHTML+=a;var n=e.players.length;for(let e=0;e<n;e++)l.innerHTML+=t["player_"+e];load_dashboard_elements()}else l.innerHTML+=t.error_message,load_error_page_elements();load_final_elements()}},o.send(i)}})}let topbar;function load_easter_eggs(){easter_egg_characters(),easter_egg_kaaris()}function easter_egg_characters(){var e=["abigail","alex","caroline","clint","demetrius","elliott","emily","evelyn","george","gus","haley","harvey","jas","jodi","kent","leah","lewis","linus","marnie","maru","pam","penny","pierre","robin","sam","sandy","sebastian","shane","vincent","willy","wizard"],a=new Date;let o=e[[new Date(a.getFullYear(),0,1).getTime(),a.getUTCMonth(),a.getUTCDate()].reduce((e,t)=>e*t,1)%e.length];a=document.querySelectorAll(".character-name."+o);if(0!==a.length){let t=new Audio(get_site_root()+"/assets/audio/trigger.mp3"),n=!1,l=()=>{if(!n){n=!0;let e=document.createElement("img");e.src=`https://raw.githubusercontent.com/NicolasVero/stardew-dashboard/refs/heads/master/assets/images/characters/${o}.png`,e.classList.add("fullscreen-image"),document.body.appendChild(e),e.classList.add("show"),t.play().finally(()=>{n=!1}),setTimeout(()=>{e.classList.remove("show"),e.addEventListener("transitionend",()=>{e.remove()})},1e3)}};a.forEach(e=>{e.addEventListener("dblclick",l)})}}function easter_egg_kaaris(){var n=null==(n=null==(n=document.querySelector(".house"))?void 0:n.previousElementSibling)?void 0:n.querySelector("img");if(null!==n){n.classList.add("easter_egg_kaaris");let e=new Audio(get_site_root()+"/assets/audio/kaaris_maison-citrouille.mp3"),t=!1;n.addEventListener("dblclick",()=>{t||(t=!0,e.play().finally(()=>t=!1))})}}function load_error_page_elements(){[{open_button:".main-settings",exit_button:".exit-settings",modal_panel:".settings"},{open_button:".main-languages",exit_button:".exit-languages",modal_panel:".languages-panel"},{open_button:".file-upload",exit_button:".exit-upload",modal_panel:".upload-panel"}].forEach(({open_button:e,exit_button:t,modal_panel:n})=>{activate_buttons(e,t,n)})}function load_dashboard_elements(){toggle_landing_page(!1),load_buttons(),load_easter_eggs(),initialize_settings(),toggle_checkboxes_actions(),update_tooltips_after_ajax(),prevent_panel_scroll(),initialize_player_swapper(get_players_number())}function load_buttons(){var e,n=get_players_number();let l=[];var a=["all-friends","all-quests","monster-eradication-goals","calendar","all-animals","junimo-kart-leaderboard","museum","community-center","visited-locations"];for(let t=0;t<n;t++)a.forEach(e=>{l.push({open_button:`.view-${e}-`+t,exit_button:`.exit-${e}-`+t,modal_panel:`.${e}-`+t})});[{open_button:".landing-settings",exit_button:".exit-settings",modal_panel:".settings"},{open_button:".landing-languages",exit_button:".exit-languages",modal_panel:".languages"},{open_button:".landing-upload",exit_button:".exit-upload",modal_panel:".upload-panel"},{open_button:".main-settings",exit_button:".exit-settings",modal_panel:".settings"},{open_button:".file-upload",exit_button:".exit-upload",modal_panel:".upload-panel"},{open_button:".main-languages",exit_button:".exit-languages",modal_panel:".languages-panel"},...l].forEach(({open_button:e,exit_button:t,modal_panel:n})=>{activate_buttons(e,t,n)}),null!=(e=document.getElementById("home-icon"))&&e.addEventListener("click",()=>{var e;toggle_landing_page(!("none"!==(null==(e=document.getElementById("landing_page"))?void 0:e.style.display)))})}function load_final_elements(){activate_feedback_ajax_trigger(),toggle_visibility(current_section,!1),toggle_loading(!1)}function activate_feedback_ajax_trigger(){document.querySelectorAll(".feedback-opener").forEach(e=>{e.addEventListener("click",()=>{var e=document.querySelector(".feedback-panel");hide_all_sections(),e?toggle_visibility(e,!0):feedback_form_creation()})})}function feedback_form_creation(){let n=document.querySelector("body");fetch("./functions.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"display_feedback_panel"})}).then(e=>e.text()).then(e=>{var t=document.createElement("div");for(current_section=document.querySelector(".feedback-panel"),t.innerHTML=e;t.firstChild;)null!=n&&n.appendChild(t.firstChild);feedback_custom_radio(),activate_feedback_form(),activate_close_buttons(".exit-feedback",".feedback-panel")}).catch(e=>console.error("Error:",e))}function activate_feedback_form(){let t=document.getElementById("feedback_form");null!=t&&t.addEventListener("submit",e=>{e.preventDefault();e=new FormData(t);fetch("./includes/sendmail.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{e=e.success?e.message:"Error submitting form: "+e.message;alert(e)}).catch(e=>{console.error("Error:",e),alert("An error occurred while submitting the form.")})})}function feedback_custom_radio(){let n=document.querySelectorAll(".feedback_custom_radio");var e=document.querySelectorAll(".feedback_real_radio");n.forEach(t=>{t.parentElement.addEventListener("click",()=>{var e=t.previousElementSibling;null!==e&&"radio"===e.type&&(e.checked=!0,e.dispatchEvent(new Event("change")))})}),e.forEach(t=>{t.addEventListener("change",()=>{n.forEach(e=>{e.classList.add("topic_not_selected")});var e=t.nextElementSibling;null!==e&&"IMG"===e.tagName&&(t.checked?e.classList.remove("topic_not_selected"):e.classList.add("topic_not_selected"))})})}window.addEventListener("load",()=>{var e=get_os_path(detect_os()),t=document.getElementById("save_os_path"),t=(null!==t&&(t.innerHTML=e),document.getElementById("toggle_versions_items_mode")),e=document.getElementById("no_spoil_mode"),n=document.getElementById("spoil_mode"),l=document.getElementById("steam_achievements"),t=(null!==t&&t.addEventListener("change",handle_toggle_versions_mode),null!==e&&e.addEventListener("change",handle_no_spoil_mode),null!==n&&n.addEventListener("change",handle_spoil_mode),null!==l&&l.addEventListener("change",handle_steam_mode),document.getElementById("save-upload"));null!==t&&t.addEventListener("change",file_choice),save_landing_topbar(),prevent_panel_scroll(),activate_buttons(".landing-upload",".exit-upload",".upload-panel"),activate_buttons(".landing-languages",".exit-languages",".languages-panel"),activate_buttons(".landing-settings",".exit-settings",".settings"),toggle_custom_checkboxes(".checkmark"),activate_feedback_ajax_trigger()});let panels={Digit1:".visited-locations",Digit2:".monster-eradication-goals",Digit3:".junimo-kart-leaderboard",Digit4:".all-quests",Digit5:".all-friends",Digit6:".calendar",Digit7:".all-animals",Digit8:".museum",Digit9:".community-center"},all_panels=Object.values(panels),current_section=(window.addEventListener("keydown",e=>{var t;"Escape"===e.code&&close_all_panels(all_panels,!0),panels[e.code]&&(e=panels[e.code]+"-"+get_current_player_id(),t="block"===(null==(e=document.querySelector(e))?void 0:e.style.display)?"none":"block",close_all_panels(all_panels),e.style.display=t)}),window.addEventListener("click",e=>{can_close_panel(e)&&close_all_panels(all_panels,!0)}),null);function activate_buttons(e,t,n){e=document.querySelectorAll(e),t=document.querySelectorAll(t);let l=document.querySelector(n);e.forEach(e=>{e.addEventListener("click",()=>{hide_all_sections(!0),null!==l&&(toggle_visibility(current_section=l,!0),l.hasAttribute("data-tooltips-initialized")||(initialize_tooltips(l.classList[0]),l.setAttribute("data-tooltips-initialized","true")))})}),t.forEach(e=>{e.addEventListener("click",()=>{hide_all_sections(!0),current_section=null})})}function activate_close_buttons(e,t){e=document.querySelectorAll(e);let n=document.querySelector(t);e.forEach(e=>{e.addEventListener("click",()=>{null!==n&&(n.remove(),current_section=null)})})}function hide_all_sections(t=!1){document.querySelectorAll(".modal-window").forEach(e=>{e.classList.contains("to-destroy")&&t&&e.remove(),e.style.display="none"})}function prevent_panel_scroll(){document.querySelectorAll(".modal-window").forEach(l=>{l.addEventListener("wheel",e=>{var t=l.scrollTop,n=0===t&&e.deltaY<0,t=l.scrollHeight<=t+l.clientHeight&&0<e.deltaY;(n||t)&&e.preventDefault()},{passive:!1})})}(e=>{e.mac="mac",e.linux="linux",e.windows="windows"})(OS=OS||{});let os_paths=new Map([[OS.mac,"(~/.config/StardewValley/Saves/)."],[OS.linux,"(~/.steam/debian-installation/steamapps/compatdata/413150/pfx/drive_c/users/steamuser/AppData/Roaming/StardewValley/Saves/)."],[OS.windows,"(%AppData%/StardewValley/Saves/SaveName)."]]);function detect_os(){var e=window.navigator.userAgent.toLowerCase();return e.includes("mac")?OS.mac:e.includes("linux")?OS.linux:OS.windows}function get_os_path(e=OS.windows){return os_paths.get(e)||""}function initialize_player_swapper(t){var n=document.getElementsByClassName("player_selection");for(let e=0;e<n.length;e++)n[e].addEventListener("click",()=>{swap_displayed_player(e%t)})}function swap_displayed_player(t){var n=document.getElementsByClassName("player_container");for(let e=0;e<n.length;e++)n[e].style.display=t!==e?"none":"block",n[e].style.opacity="1"}function get_settings(){return{no_spoil:document.getElementById("no_spoil_mode").checked,toggle_versions:document.getElementById("toggle_versions_items_mode").checked,spoil:document.getElementById("spoil_mode").checked}}function initialize_settings(){handle_toggle_versions_mode(),handle_no_spoil_mode(),handle_spoil_mode()}function handle_no_spoil_mode(){var e=document.getElementById("spoil_mode"),t=document.getElementById("no_spoil_mode");null!==t&&null!==e&&t.checked&&e.checked&&(e.checked=!1),update_display(["not-found","found"])}function handle_toggle_versions_mode(){update_display(["newer-version"])}function handle_spoil_mode(){var e=document.getElementById("no_spoil_mode"),t=document.getElementById("spoil_mode");null!==e&&null!==t&&(t.checked&&e.checked?(e.checked=!1,update_display(["not-found","found"])):update_display(["found"]))}function handle_steam_mode(){let a=["steam_achievements","achievements"];document.querySelectorAll(".achievements-section img").forEach(e=>{var t=e.getAttribute("src"),[n,l]=t.includes("steam")?a:[...a].reverse();e.setAttribute("src",t.replace(n,l))})}function wiki_redirections(){document.querySelectorAll("a").forEach(e=>{e.addEventListener("click",e=>{document.getElementById("wiki_redirections").checked||(e.preventDefault(),e.stopImmediatePropagation())})})}function toggle_custom_checkboxes(e){document.querySelectorAll(e).forEach(t=>{t.addEventListener("click",()=>{var e=t.previousElementSibling;null!==e&&"checkbox"===e.type&&(e.checked=!e.checked,e.dispatchEvent(new Event("change")))})})}function toggle_checkboxes_actions(){document.querySelectorAll(".checkbox input[type='checkbox']").forEach(e=>{var t=e.id;e.checked&&"function"==typeof window[t]&&window[t]()})}function update_tooltips_after_ajax(){on_images_loaded(()=>{initialize_tooltips(),swap_displayed_player(0)})}function initialize_tooltips(e=null){let t;(t=(null===e||""===e?document:document.querySelector("."+e)).querySelectorAll(".tooltip")).forEach(e=>{var t=e.getBoundingClientRect();let n=e.querySelector("span");n&&!["left","right"].some(e=>n.classList.contains(e))&&0!==t.left&&(e=t.left<window.innerWidth/2?"right":"left",n.classList.add(e))})}function on_images_loaded(e){let n=0;var l=document.querySelectorAll("img");let a=l.length;if(0===a)e();else{let t=()=>{++n===a&&e()};l.forEach(e=>{e.complete?t():(e.addEventListener("load",t),e.addEventListener("error",t))}),n===a&&e()}}function update_section_visibility(e,t){var n=e.querySelector("h2"),l=null==(l=e.children[1])?void 0:l.querySelector("span .no-spoil-title"),a=is_section_empty(e),o=has_section_older_version_items(e);if(t.toggle_versions&&a&&!o)e.classList.add("hidden");else if(e.classList.remove("hidden"),null!==n&&(n.style.display="block"),null!==l){let e=!1;e=!t.no_spoil&&t.toggle_versions?a&&o:a,l.style.display=e?"block":"none"}}function update_display(e){let n=get_settings();e.forEach(e=>{e=document.getElementsByClassName(e);Array.from(e).forEach(e=>{var t=get_parent_element(e);null!==t&&set_element_display(t,should_show_element(e,n))})});e=document.getElementsByClassName("gallery");Array.from(e).forEach(e=>update_section_visibility(e,n))}function get_site_root(){var e=window.location.protocol;return"localhost"===window.location.host?e+"//localhost/travail/stardew_dashboard":e+"//stardew-dashboard.42web.io"}function get_max_upload_size(){return __awaiter(this,void 0,void 0,function*(){return fetch("./functions.php?action=get_max_upload_size").then(e=>e.json()).then(e=>e.post_max_size)})}function in_bytes_conversion(e){var t,e=e.match(/(\d+)([a-zA-Z]+)/);if(e)return t=parseInt(e[1],10),e=e[2],t*Math.pow(1024,{o:0,Ko:1,Mo:2,Go:3}[e]);throw new Error("Invalid size format")}function toggle_visibility(e,t){e.style.display=t?"block":"none"}function get_current_player_id(){var e=Array.from(document.querySelectorAll(".player_container")).find(e=>"block"===window.getComputedStyle(e).display);return null!==e&&(e=e.className.match(/player_(\d+)_container/))?parseInt(e[1],10):null}function get_players_number(){var e=document.querySelector("#players_selection");return null!==e?0===(e=e.getElementsByTagName("li").length)?1:e:null}function get_deletabled_settings_panels(){return[".feedback-panel"]}function get_closabled_settings_panels(){return[".upload-panel",".settings-panel"]}function get_settings_panels(){return[...get_closabled_settings_panels(),...get_deletabled_settings_panels()]}function close_all_panels(e,t=!1){let n=t?get_settings_panels():[];e.push(...n),e.forEach(e=>{var e=e+(n.includes(e)?"":"-"+get_current_player_id()),t=document.querySelector(e);null!==t&&(t.style.display="none",get_deletabled_settings_panels().includes(e))&&t.remove()})}function can_close_panel(e){return current_section&&e.target instanceof HTMLElement&&e.target!==current_section&&!current_section.contains(e.target)&&!e.target.classList.contains("modal-opener")&&!current_section.classList.contains("to-keep-open")}function toggle_loading(e){var t=document.querySelector("#loading-strip");null!==t&&(t.style.display=e?"block":"none")}function get_parent_element(e){return null===e?null:null!=(e=e.parentElement)&&e.classList.contains("wiki_link")?e.parentElement:e}function set_element_display(e,t){null!==e&&"locations"!==e.className&&(e.style.display=t?"flex":"none")}function has_class(e,t){return e.classList.contains(t)}function is_section_empty(e){e=e.querySelectorAll(".tooltip");return Array.from(e).every(e=>"none"===e.style.display)}function has_section_older_version_items(e){return Array.from(e.querySelectorAll("img")).some(e=>has_class(e,"older-version"))}function should_show_element(e,t){var n=has_class(e,"newer-version"),l=has_class(e,"not-found"),a=has_class(e,"always-on-display"),o=has_class(e,"found");return!!has_class(e,"not-hide")||!(t.toggle_versions&&n||t.no_spoil&&l&&!a||t.spoil&&o)}function toggle_landing_page(e){var t=document.getElementById("landing_page");null!==t&&(t.style.display=e?"block":"none")}function save_landing_topbar(){var e=document.getElementById("landing_menu");null!==e&&e.innerHTML}